"use strict";(self.webpackChunkflorkafun_backend=self.webpackChunkflorkafun_backend||[]).push([[6e3],{8589:(B,p,e)=>{e.d(p,{u:()=>D});var s=e(21272),a=e(56445),P=e(74930);function D(c={},T={}){const{id:g="",...f}=c,{get:y}=(0,a.ry)(),{data:u,isError:A,isLoading:R,refetch:C}=(0,P.useQuery)(["users",g,f],async()=>{const{data:{data:M}}=await y(`/admin/users/${g}`,{params:f});return M},T);return{users:s.useMemo(()=>{let M=[];return u&&("results"in u?Array.isArray(u.results)&&(M=u.results):M=[u]),M},[u]),pagination:s.useMemo(()=>(u&&"pagination"in u)??null,[u]),isLoading:R,isError:A,refetch:C}}},74773:(B,p,e)=>{e.d(p,{B:()=>P});var s=e(92132),a=e(83997);const P=({startActions:D,endActions:c})=>!D&&!c?null:(0,s.jsxs)(a.s,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,s.jsx)(a.s,{gap:2,wrap:"wrap",children:D}),(0,s.jsx)(a.s,{gap:2,shrink:0,wrap:"wrap",children:c})]})},80782:(B,p,e)=>{e.d(p,{j:()=>a});var s=e(76517);const a=s.c$},86e3:(B,p,e)=>{e.r(p),e.d(p,{default:()=>me});var s=e(92132),a=e(56445),P=e(82437),D=e(97927),c=e(94061),T=e(76517),g=e(80782),f=e(90151),y=e(88353),u=e(4171),A=e(42455),R=e(74773),C=e(4198),U=e(55356),M=e(43064),F=e(38413),Z=e(61485),X=e(99248),w=e(6239),j=e(83997),k=e(25641),q=e(90361),z=e(33363),x=e(30893),v=e(54894),ee=e(90532),Q=e(74930),se=e(17703),te=e(8589),ae=e(37679),ne=e(60043),i=e(33544),ie=e(62490),oe=e(83925),ue=e(21272),Ee=e(55151),ge=e(79077),ce=e(59057),pe=e(15126),Me=e(63299),De=e(67014),Oe=e(59080),Pe=e(79275),Le=e(14718),fe=e(61535),ye=e(5790),Ae=e(12083),Ce=e(41286),he=e(35223),Te=e(5409),Re=e(2600),Ue=e(48940),ve=e(51187);const re=({canReadAuditLogs:t,canReadUsers:l})=>{const{get:m}=(0,a.ry)(),{search:o}=(0,se.zy)(),_=(0,a.hN)(),[{query:d}]=(0,a.sq)(),n={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:O=>_({type:"warning",message:O.message})},{users:r,isError:E,isLoading:L}=(0,te.u)({},{...n,enabled:l,staleTime:2*(1e3*60)}),{data:h,isLoading:W,isError:S}=(0,Q.useQuery)(["auditLogs",o],async()=>{const{data:O}=await m("/admin/audit-logs",{params:d});return O},{...n,enabled:t});return{auditLogs:h,users:r,isLoading:L||W,hasError:S||E}},G=()=>{const{formatDate:t}=(0,v.A)();return m=>{const o=(0,ie.A)(m),_=t(o,{dateStyle:"long"}),d=t(o,{timeStyle:"medium",hourCycle:"h24"});return`${_}, ${d}`}},H={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},N=t=>H[t]||t,I=({actionLabel:t,actionName:l})=>(0,s.jsxs)(j.s,{direction:"column",alignItems:"baseline",gap:1,children:[(0,s.jsx)(x.o,{textColor:"neutral600",variant:"sigma",children:t}),(0,s.jsx)(x.o,{textColor:"neutral600",children:l})]});I.propTypes={actionLabel:i.string.isRequired,actionName:i.string.isRequired};const $=({status:t,data:l,formattedDate:m})=>{const{formatMessage:o}=(0,v.A)();if(t==="loading")return(0,s.jsx)(j.s,{padding:7,justifyContent:"center",alignItems:"center",children:(0,s.jsx)(M.a,{children:"Loading content..."})});const{action:_,user:d,payload:n}=l;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.a,{marginBottom:3,children:(0,s.jsx)(x.o,{variant:"delta",id:"title",children:o({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"})})}),(0,s.jsxs)(f.x,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0,children:[(0,s.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:o({id:`Settings.permissions.auditLogs.${_}`,defaultMessage:N(_)},{model:n?.model})}),(0,s.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:m}),(0,s.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:d?.displayName||"-"}),(0,s.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:d?.id.toString()||"-"})]}),(0,s.jsx)(u.j,{value:JSON.stringify(n,null,2),disabled:!0,label:o({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})})]})};$.defaultProps={data:{}},$.propTypes={status:i.oneOf(["idle","loading","error","success"]).isRequired,data:i.shape({action:i.string,date:i.string,payload:i.object,user:i.object}),formattedDate:i.string.isRequired};const Y=({handleClose:t,logId:l})=>{const{get:m}=(0,a.ry)(),o=(0,a.hN)(),_=async L=>{const{data:h}=await m(`/admin/audit-logs/${L}`);if(!h)throw new Error("Audit log not found");return h},{data:d,status:n}=(0,Q.useQuery)(["audit-log",l],()=>_(l),{onError(){o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),t()}}),r=G(),E=d?r(d.date):"";return(0,s.jsxs)(Z.k,{onClose:t,labelledBy:"title",children:[(0,s.jsx)(X.r,{children:(0,s.jsx)(ae.B,{label:E,id:"title",children:(0,s.jsx)(ne.m,{isCurrent:!0,children:E})})}),(0,s.jsx)(w.c,{children:(0,s.jsx)($,{status:n,data:d,formattedDate:E})})]})};Y.propTypes={handleClose:i.func.isRequired,logId:i.string.isRequired};const b=({pagination:t})=>(0,s.jsx)(c.a,{paddingTop:4,children:(0,s.jsxs)(j.s,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,s.jsx)(a._u,{}),(0,s.jsx)(a.W7,{pagination:t})]})});b.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},b.propTypes={pagination:i.shape({page:i.number,pageCount:i.number,pageSize:i.number,total:i.number})};const V=({headers:t,rows:l,onOpenModal:m})=>{const{formatMessage:o}=(0,v.A)(),_=G(),d=({type:n,value:r,model:E})=>n==="date"?_(r):n==="action"?o({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:N(r)},{model:E}):r||"-";return(0,s.jsx)(k.N,{children:l.map(n=>(0,s.jsxs)(q.Tr,{...(0,a.qM)({fn:()=>m(n.id)}),children:[t.map(({key:r,name:E,cellFormatter:L})=>(0,s.jsx)(z.Td,{children:(0,s.jsx)(x.o,{textColor:"neutral800",children:d({type:r,value:L?L(n[E]):n[E],model:n.payload?.model})})},r)),(0,s.jsx)(z.Td,{...a.dG,children:(0,s.jsx)(j.s,{justifyContent:"end",children:(0,s.jsx)(y.K,{onClick:()=>m(n.id),"aria-label":o({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${n.action} action`}),noBorder:!0,icon:(0,s.jsx)(oe.A,{})})})})]},n.id))})};V.defaultProps={rows:[]},V.propTypes={headers:i.array.isRequired,rows:i.array,onOpenModal:i.func.isRequired};const K=({value:t,options:l,onChange:m})=>{const{formatMessage:o}=(0,v.A)(),_=o({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return(0,s.jsx)(T.G3,{"aria-label":_,value:t,onChange:m,children:l.map(({label:d,customValue:n})=>(0,s.jsx)(g.j,{value:n,children:d},n))})};K.defaultProps={value:null},K.propTypes={value:i.string,options:i.arrayOf(i.shape({label:i.string.isRequired,customValue:i.string.isRequired}).isRequired).isRequired,onChange:i.func.isRequired};const J=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],de=({formatMessage:t,users:l,canReadUsers:m})=>{const o=Object.keys(H).map(d=>({label:t({id:`Settings.permissions.auditLogs.${d}`,defaultMessage:N(d)},{model:void 0}),customValue:d})),_=[{name:"action",metadatas:{customOperators:J,label:t({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),customInput:K,options:o},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:t({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(m&&l){const d=r=>r.username?r.username:r.firstname&&r.lastname?t({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:r.firstname,lastname:r.lastname}):r.email,n=l.map(r=>({label:d(r),customValue:r.id.toString()}));return[..._,{name:"user",metadatas:{customOperators:J,label:t({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:n,customInput:K},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return _},le=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:t=>t?t.displayName:""}],_e=()=>{const{formatMessage:t}=(0,v.A)(),l=(0,P.d4)(D.s),{allowedActions:{canRead:m,canReadUsers:o}}=(0,a.ec)({...l.settings.auditLogs,readUsers:l.settings.users.read}),[{query:_},d]=(0,a.sq)(),{auditLogs:n,users:r,isLoading:E,hasError:L}=re({canReadAuditLogs:m,canReadUsers:o});(0,a.L4)();const h=de({formatMessage:t,users:r,canReadUsers:o}),W=t({id:"global.auditLogs",defaultMessage:"Audit Logs"}),S=le.map(O=>({...O,metadatas:{...O.metadatas,label:t(O.metadatas.label)}}));return L?(0,s.jsx)(A.P,{children:(0,s.jsx)(C.s,{children:(0,s.jsx)(c.a,{paddingTop:8,children:(0,s.jsx)(a.hH,{})})})}):(0,s.jsxs)(F.g,{"aria-busy":E,children:[(0,s.jsx)(a.x7,{name:W}),(0,s.jsx)(U.Q,{title:W,subtitle:t({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),(0,s.jsx)(R.B,{startActions:(0,s.jsx)(ee.F,{displayedFilters:h})}),(0,s.jsxs)(C.s,{canRead:m,children:[(0,s.jsx)(a.Ee,{contentType:"Audit logs",headers:S,rows:n?.results||[],withBulkActions:!0,isLoading:E,children:(0,s.jsx)(V,{headers:S,rows:n?.results||[],onOpenModal:O=>d({id:O})})}),(0,s.jsx)(b,{pagination:n?.pagination})]}),_?.id&&(0,s.jsx)(Y,{handleClose:()=>d({id:null},"remove"),logId:_.id})]})},me=()=>{const t=(0,P.d4)(D.s);return(0,s.jsx)(a.kz,{permissions:t.settings.auditLogs.main,children:(0,s.jsx)(_e,{})})}},90532:(B,p,e)=>{e.d(p,{F:()=>y});var s=e(92132),a=e(21272),P=e(94061),D=e(85963),c=e(56445),T=e(28604),g=e(33544),f=e(54894);const y=({displayedFilters:u})=>{const[A,R]=(0,a.useState)(!1),{formatMessage:C}=(0,f.A)(),U=(0,a.useRef)(),M=()=>{R(F=>!F)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(P.a,{paddingTop:1,paddingBottom:1,children:[(0,s.jsx)(D.$,{variant:"tertiary",ref:U,startIcon:(0,s.jsx)(T.A,{}),onClick:M,size:"S",children:C({id:"app.utils.filters",defaultMessage:"Filters"})}),A&&(0,s.jsx)(c.LC,{displayedFilters:u,isVisible:A,onToggle:M,source:U})]}),(0,s.jsx)(c.cZ,{filtersSchema:u})]})};y.propTypes={displayedFilters:g.arrayOf(g.shape({name:g.string.isRequired,metadatas:g.shape({label:g.string}),fieldSchema:g.shape({type:g.string})})).isRequired}}}]);
