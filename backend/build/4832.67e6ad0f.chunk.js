"use strict";(self.webpackChunkflorkafun_backend=self.webpackChunkflorkafun_backend||[]).push([[4832],{80782:(ae,v,s)=>{s.d(v,{j:()=>_});var e=s(76517);const _=e.c$},94832:(ae,v,s)=>{s.r(v),s.d(v,{default:()=>Oe});var e=s(92132),_=s(56445),l=s(55126),M=s(21272),d=s(33544),U=s(94061),p=s(85963),W=s(4181),te=s(76517),le=s(80782),N=s(48653),ne=s(53563),b=s(90151),O=s(68074),$=s(88353),ie=s(4198),oe=s(55356),de=s(11273),ce=s(38413),F=s(61485),V=s(99248),G=s(67030),Q=s(6239),C=s(83997),re=s(43739),ge=s(95336),L=s(12408),P=s(24093),Y=s(12081),_e=s(35513),Ee=s(25641),ue=s(26127),z=s(90361),D=s(33363),X=s(7537),m=s(30893),me=s(98765),H=s(54514),he=s(36481),Me=s(41909),J=s(5194),De=s(50612),h=s(54894),x=s(61535),fe=s(2600),A=s(82437),T=s(12083),ye=s(74930),Ae=s(412),Te=s(5409),Re=s(48940),Be=s(51187),Ie=s(59080),Ke=s(35223);const pe=()=>{const[t,n]=(0,M.useState)(!1),i=(0,A.wA)(),a=(0,_.hN)(),{post:o}=(0,_.ry)();return{isAdding:t,addLocale:async r=>{n(!0);try{const{data:g}=await o("/i18n/locales",r);a({type:"success",message:{id:(0,l.g)("Settings.locales.modal.create.success")}}),i({type:l.A,newLocale:g})}catch(g){const E=fe(g,"response.payload.message",null);throw E&&E.includes("already exists")?a({type:"warning",message:{id:(0,l.g)("Settings.locales.modal.create.alreadyExist")}}):a({type:"warning",message:{id:"notification.error"}}),g}finally{n(!1)}}}},Z=(0,T.Ik)().shape({code:(0,T.Yj)().required(),displayName:(0,T.Yj)().max(50,"Settings.locales.modal.locales.displayName.error").required(_.iW.required)}),Le=()=>{const{values:t,setFieldValue:n}=(0,x.j7)(),{formatMessage:i}=(0,h.A)();return(0,e.jsx)(W.S,{hint:i({id:(0,l.g)("Settings.locales.modal.advanced.setAsDefault.hint"),defaultMessage:"One default locale is required, change it by selecting another one"}),onChange:()=>n("isDefault",!t.isDefault),value:t.isDefault,children:i({id:(0,l.g)("Settings.locales.modal.advanced.setAsDefault"),defaultMessage:"Set as default locale"})})},w=()=>{const{formatMessage:t}=(0,h.A)(),{notifyStatus:n}=(0,de.W)(),i=(0,_.hN)(),{get:a}=(0,_.ry)(),{isLoading:o,data:c}=(0,ye.useQuery)(["plugin-i18n","locales"],async()=>{try{const{data:r}=await a("/i18n/iso-locales");return n(t({id:(0,l.g)("Settings.locales.modal.locales.loaded"),defaultMessage:"The locales have been successfully loaded."})),r}catch{return i({type:"warning",message:{id:"notification.error"}}),[]}});return{defaultLocales:c,isLoading:o}},R=M.memo(({value:t,onClear:n,onLocaleChange:i,error:a})=>{const{formatMessage:o}=(0,h.A)(),{defaultLocales:c,isLoading:r}=w(),{locales:g}=(0,l.u)(),E=(c||[]).map(u=>({label:u.name,value:u.code})).filter(({value:u})=>{const f=g.find(({code:j})=>j===u);return!f||f.code===t}),y=t||"";return(0,e.jsx)(te.G3,{"aria-busy":r,error:a,label:o({id:(0,l.g)("Settings.locales.modal.locales.label"),defaultMessage:"Locales"}),value:y,onClear:t?n:void 0,onChange:u=>{const f=E.find(j=>j.value===u);f&&i({code:f.value,displayName:f.label})},placeholder:o({id:"components.placeholder.select",defaultMessage:"Select"}),children:E.map(u=>(0,e.jsx)(le.j,{value:u.value,children:u.label},u.value))})});R.defaultProps={error:void 0,value:void 0,onClear(){},onLocaleChange:()=>{}},R.propTypes={error:d.string,onClear:d.func,onLocaleChange:d.func,value:d.string};const Pe=()=>{const{formatMessage:t}=(0,h.A)(),{values:n,handleChange:i,setFieldValue:a,errors:o}=(0,x.j7)(),c=(0,M.useCallback)(g=>{a("displayName",g.displayName),a("code",g.code)},[a]),r=(0,M.useCallback)(()=>{a("displayName",""),a("code","")},[a]);return(0,e.jsxs)(b.x,{gap:4,children:[(0,e.jsx)(O.E,{col:6,children:(0,e.jsx)(R,{error:o.code,value:n.code,onLocaleChange:c,onClear:r})}),(0,e.jsx)(O.E,{col:6,children:(0,e.jsx)(X.k,{name:"displayName",label:t({id:(0,l.g)("Settings.locales.modal.locales.displayName"),defaultMessage:"Locale display name"}),hint:t({id:(0,l.g)("Settings.locales.modal.locales.displayName.description"),defaultMessage:"Locale will be displayed under that name in the administration panel"}),error:o.displayName?t({id:(0,l.g)("Settings.locales.modal.locales.displayName.error"),defaultMessage:"The locale display name can only be less than 50 characters."}):void 0,value:n.displayName,onChange:i})})]})},xe={code:"",displayName:"",isDefault:!1},q=({onClose:t})=>{const{isAdding:n,addLocale:i}=pe(),{formatMessage:a}=(0,h.A)(),{refetchPermissions:o}=(0,_.r5)(),c=async r=>{await i({code:r.code,name:r.displayName,isDefault:r.isDefault}),await o()};return(0,e.jsx)(F.k,{onClose:t,labelledBy:"add-locale-title",children:(0,e.jsx)(x.l1,{initialValues:xe,onSubmit:c,validationSchema:Z,validateOnChange:!1,children:(0,e.jsxs)(_.lV,{children:[(0,e.jsx)(V.r,{children:(0,e.jsx)(m.o,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"add-locale-title",children:a({id:(0,l.g)("Settings.list.actions.add"),defaultMessage:"Add new locale"})})}),(0,e.jsx)(Q.c,{children:(0,e.jsxs)(Y.f,{label:a({id:(0,l.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"}),id:"tabs",variant:"simple",children:[(0,e.jsxs)(C.s,{justifyContent:"space-between",children:[(0,e.jsx)(m.o,{as:"h2",variant:"beta",children:a({id:(0,l.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"})}),(0,e.jsxs)(L.t,{children:[(0,e.jsx)(L.o,{children:a({id:(0,l.g)("Settings.locales.modal.base"),defaultMessage:"Basic settings"})}),(0,e.jsx)(L.o,{children:a({id:(0,l.g)("Settings.locales.modal.advanced"),defaultMessage:"Advanced settings"})})]})]}),(0,e.jsx)(N.c,{}),(0,e.jsx)(U.a,{paddingTop:7,paddingBottom:7,children:(0,e.jsxs)(P.T,{children:[(0,e.jsx)(P.K,{children:(0,e.jsx)(Pe,{})}),(0,e.jsx)(P.K,{children:(0,e.jsx)(Le,{})})]})})]})}),(0,e.jsx)(G.j,{startActions:(0,e.jsx)(p.$,{variant:"tertiary",onClick:t,children:a({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(p.$,{type:"submit",startIcon:(0,e.jsx)(H.A,{}),disabled:n,children:a({id:"global.save",defaultMessage:"Save"})})})]})})})};q.propTypes={onClose:d.func.isRequired};const je=()=>{const[t,n]=(0,M.useState)(!1),i=(0,A.wA)(),a=(0,_.hN)(),{del:o}=(0,_.ry)();return{isDeleting:t,deleteLocale:async r=>{try{n(!0),await o(`/i18n/locales/${r}`),a({type:"success",message:{id:(0,l.g)("Settings.locales.modal.delete.success")}}),i({type:l.D,id:r})}catch{a({type:"warning",message:{id:"notification.error"}})}finally{n(!1)}}}},B=({localeToDelete:t,onClose:n})=>{const{isDeleting:i,deleteLocale:a}=je(),o=Boolean(t),c=()=>a(t.id).then(n);return(0,e.jsx)(_.TM,{isConfirmButtonLoading:i,onConfirm:c,onToggleDialog:n,isOpen:o})};B.defaultProps={localeToDelete:void 0},B.propTypes={localeToDelete:d.shape({id:d.number.isRequired}),onClose:d.func.isRequired};const ve=()=>{const[t,n]=(0,M.useState)(!1),i=(0,A.wA)(),a=(0,_.hN)(),{put:o}=(0,_.ry)();return{isEditing:t,editLocale:async(r,g)=>{try{n(!0);const{data:E}=await o(`/i18n/locales/${r}`,g);a({type:"success",message:{id:(0,l.g)("Settings.locales.modal.edit.success")}}),i({type:l.U,editedLocale:E})}catch{a({type:"warning",message:{id:"notification.error"}})}finally{n(!1)}}}},k=({isDefaultLocale:t})=>{const{values:n,setFieldValue:i}=(0,x.j7)(),{formatMessage:a}=(0,h.A)();return(0,e.jsx)(W.S,{name:"isDefault",hint:a({id:(0,l.g)("Settings.locales.modal.advanced.setAsDefault.hint"),defaultMessage:"One default locale is required, change it by selecting another one"}),onChange:()=>i("isDefault",!n.isDefault),value:n.isDefault,disabled:t,children:a({id:(0,l.g)("Settings.locales.modal.advanced.setAsDefault"),defaultMessage:"Set as default locale"})})};k.propTypes={isDefaultLocale:d.bool.isRequired};const ee=({locale:t})=>{const{formatMessage:n}=(0,h.A)(),{values:i,handleChange:a,errors:o}=(0,x.j7)(),{defaultLocales:c,isLoading:r}=w(),g=!r&&c.find(E=>E.code===t.code);return(0,e.jsxs)(b.x,{gap:4,children:[(0,e.jsx)(O.E,{col:6,children:(0,e.jsx)(re.l,{label:n({id:(0,l.g)("Settings.locales.modal.locales.label"),defaultMessage:"Locales"}),value:g?.code||t.code,disabled:!0,children:(0,e.jsx)(ge.c,{value:g?.code||t.code,children:g?.name||t.code})})}),(0,e.jsx)(O.E,{col:6,children:(0,e.jsx)(X.k,{name:"displayName",label:n({id:(0,l.g)("Settings.locales.modal.locales.displayName"),defaultMessage:"Locale display name"}),hint:n({id:(0,l.g)("Settings.locales.modal.locales.displayName.description"),defaultMessage:"Locale will be displayed under that name in the administration panel"}),error:o.displayName?n({id:(0,l.g)("Settings.locales.modal.locales.displayName.error"),defaultMessage:"The locale display name can only be less than 50 characters."}):void 0,value:i.displayName,onChange:a})})]})};ee.propTypes={locale:d.shape({id:d.number.isRequired,name:d.string.isRequired,code:d.string.isRequired,isDefault:d.bool.isRequired}).isRequired};const I=({locale:t,onClose:n})=>{const{refetchPermissions:i}=(0,_.r5)(),{isEditing:a,editLocale:o}=ve(),{formatMessage:c}=(0,h.A)(),r=async({displayName:g,isDefault:E})=>{await o(t.id,{name:g,isDefault:E}),await i()};return(0,e.jsx)(F.k,{onClose:n,labelledBy:"edit-locale-title",children:(0,e.jsx)(x.l1,{initialValues:{code:t?.code,displayName:t?.name||"",isDefault:Boolean(t?.isDefault)},onSubmit:r,validationSchema:Z,children:(0,e.jsxs)(_.lV,{children:[(0,e.jsx)(V.r,{children:(0,e.jsx)(m.o,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"edit-locale-title",children:c({id:(0,l.g)("Settings.list.actions.edit"),defaultMessage:"Edit a locale"})})}),(0,e.jsx)(Q.c,{children:(0,e.jsxs)(Y.f,{label:c({id:(0,l.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"}),id:"tabs",variant:"simple",children:[(0,e.jsxs)(C.s,{justifyContent:"space-between",children:[(0,e.jsx)(m.o,{as:"h2",children:c({id:(0,l.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"})}),(0,e.jsxs)(L.t,{children:[(0,e.jsx)(L.o,{children:c({id:(0,l.g)("Settings.locales.modal.base"),defaultMessage:"Basic settings"})}),(0,e.jsx)(L.o,{children:c({id:(0,l.g)("Settings.locales.modal.advanced"),defaultMessage:"Advanced settings"})})]})]}),(0,e.jsx)(N.c,{}),(0,e.jsx)(U.a,{paddingTop:7,paddingBottom:7,children:(0,e.jsxs)(P.T,{children:[(0,e.jsx)(P.K,{children:(0,e.jsx)(ee,{locale:t})}),(0,e.jsx)(P.K,{children:(0,e.jsx)(k,{isDefaultLocale:Boolean(t&&t.isDefault)})})]})})]})}),(0,e.jsx)(G.j,{startActions:(0,e.jsx)(p.$,{variant:"tertiary",onClick:n,children:c({id:"app.components.Button.cancel"})}),endActions:(0,e.jsx)(p.$,{type:"submit",startIcon:(0,e.jsx)(H.A,{}),disabled:a,children:c({id:"global.save"})})})]})})})};I.defaultProps={locale:void 0},I.propTypes={locale:d.shape({id:d.number.isRequired,name:d.string.isRequired,code:d.string.isRequired,isDefault:d.bool.isRequired}),onClose:d.func.isRequired};const K=({locales:t,onDeleteLocale:n,onEditLocale:i})=>{const{formatMessage:a}=(0,h.A)();return(0,e.jsxs)(_e.X,{colCount:4,rowCount:t.length+1,children:[(0,e.jsx)(ue.d,{children:(0,e.jsxs)(z.Tr,{children:[(0,e.jsx)(D.Th,{children:(0,e.jsx)(m.o,{variant:"sigma",textColor:"neutral600",children:a({id:(0,l.g)("Settings.locales.row.id")})})}),(0,e.jsx)(D.Th,{children:(0,e.jsx)(m.o,{variant:"sigma",textColor:"neutral600",children:a({id:(0,l.g)("Settings.locales.row.displayName")})})}),(0,e.jsx)(D.Th,{children:(0,e.jsx)(m.o,{variant:"sigma",textColor:"neutral600",children:a({id:(0,l.g)("Settings.locales.row.default-locale")})})}),(0,e.jsx)(D.Th,{children:(0,e.jsx)(me.s,{children:"Actions"})})]})}),(0,e.jsx)(Ee.N,{children:t.map(o=>(0,e.jsxs)(z.Tr,{...(0,_.qM)({fn:()=>i(o),condition:i}),children:[(0,e.jsx)(D.Td,{children:(0,e.jsx)(m.o,{textColor:"neutral800",children:o.id})}),(0,e.jsx)(D.Td,{children:(0,e.jsx)(m.o,{textColor:"neutral800",children:o.name})}),(0,e.jsx)(D.Td,{children:(0,e.jsx)(m.o,{textColor:"neutral800",children:o.isDefault?a({id:(0,l.g)("Settings.locales.default")}):null})}),(0,e.jsx)(D.Td,{children:(0,e.jsxs)(C.s,{gap:1,justifyContent:"flex-end",..._.dG,children:[i&&(0,e.jsx)($.K,{onClick:()=>i(o),label:a({id:(0,l.g)("Settings.list.actions.edit")}),icon:(0,e.jsx)(Me.A,{}),noBorder:!0}),n&&!o.isDefault&&(0,e.jsx)($.K,{onClick:()=>n(o),label:a({id:(0,l.g)("Settings.list.actions.delete")}),icon:(0,e.jsx)(De.A,{}),noBorder:!0})]})})]},o.id))})]})};K.defaultProps={locales:[],onDeleteLocale:void 0,onEditLocale:void 0},K.propTypes={locales:d.array,onDeleteLocale:d.func,onEditLocale:d.func};const S=({canUpdateLocale:t,canDeleteLocale:n,onToggleCreateModal:i,isCreating:a})=>{const[o,c]=(0,M.useState)(),[r,g]=(0,M.useState)(),{locales:E}=(0,l.u)(),{formatMessage:y}=(0,h.A)();(0,_.L4)();const u=()=>c(void 0),f=n?c:void 0,j=()=>g(void 0),Ce=t?g:void 0;return(0,e.jsxs)(ce.g,{tabIndex:-1,children:[(0,e.jsx)(oe.Q,{primaryAction:(0,e.jsx)(p.$,{startIcon:(0,e.jsx)(J.A,{}),onClick:i,size:"S",children:y({id:(0,l.g)("Settings.list.actions.add")})}),title:y({id:(0,l.g)("plugin.name")}),subtitle:y({id:(0,l.g)("Settings.list.description")})}),(0,e.jsx)(ie.s,{children:E?.length>0?(0,e.jsx)(K,{locales:E,onDeleteLocale:f,onEditLocale:Ce}):(0,e.jsx)(ne.p,{icon:(0,e.jsx)(he.A,{width:void 0,height:void 0}),content:y({id:(0,l.g)("Settings.list.empty.title")}),action:i?(0,e.jsx)(p.$,{variant:"secondary",startIcon:(0,e.jsx)(J.A,{}),onClick:i,children:y({id:(0,l.g)("Settings.list.actions.add")})}):null})}),a&&(0,e.jsx)(q,{onClose:i}),r&&(0,e.jsx)(I,{onClose:j,locale:r}),(0,e.jsx)(B,{localeToDelete:o,onClose:u})]})};S.defaultProps={onToggleCreateModal:void 0},S.propTypes={canUpdateLocale:d.bool.isRequired,canDeleteLocale:d.bool.isRequired,onToggleCreateModal:d.func,isCreating:d.bool.isRequired};const se=({canReadLocale:t,canCreateLocale:n,canDeleteLocale:i,canUpdateLocale:a})=>{const[o,c]=(0,M.useState)(!1),r=n?()=>c(g=>!g):void 0;return t?(0,e.jsx)(S,{canUpdateLocale:a,canDeleteLocale:i,onToggleCreateModal:r,isCreating:o}):null};se.propTypes={canReadLocale:d.bool.isRequired,canCreateLocale:d.bool.isRequired,canUpdateLocale:d.bool.isRequired,canDeleteLocale:d.bool.isRequired};const Oe=()=>{const{isLoading:t,allowedActions:{canRead:n,canUpdate:i,canCreate:a,canDelete:o}}=(0,_.ec)(l.P);return t?null:(0,e.jsx)(se,{canReadLocale:n,canCreateLocale:a,canUpdateLocale:i,canDeleteLocale:o})}}}]);
