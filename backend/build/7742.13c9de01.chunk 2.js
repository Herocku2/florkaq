"use strict";(self.webpackChunkflorkafun_backend=self.webpackChunkflorkafun_backend||[]).push([[7742],{12038:($,P,s)=>{s.d(P,{u:()=>h});var a=s(21272),O=s(56445),m=s(54894),E=s(74930);const h=(W={},K={})=>{const{id:A="",...v}=W,{get:T}=(0,O.ry)(),{locale:S}=(0,m.A)(),I=(0,O.QM)(S,{sensitivity:"base"}),{data:u,error:x,isError:n,isLoading:j,refetch:N}=(0,E.useQuery)(["roles",A,v],async()=>{const{data:c}=await T(`/admin/roles/${A??""}`,{params:v});return c},K);return{roles:a.useMemo(()=>{let c=[];return u&&(Array.isArray(u.data)?c=u.data:c=[u.data]),[...c].sort((H,y)=>I.compare(H.name,y.name))},[u,I]),error:x,isError:n,isLoading:j,refetch:N}}},27742:($,P,s)=>{s.r(P),s.d(P,{SingleSignOn:()=>X,default:()=>ns});var a=s(92132),O=s(85963),m=s(90151),E=s(68074),h=s(42455),W=s(4198),K=s(55356),A=s(38413),v=s(83997),T=s(56654),S=s(43739),I=s(95336),u=s(7441),x=s(30893),n=s(56445),j=s(54514),N=s(56336),V=s(54894),c=s(82437),H=s(12038),y=s(97927),Y=s(21272),Z=s(88761),w=s(35223),B=s(79275),J=s(48940),f=s(12083),q=s(89565),ls=s(74930),is=s(55151),ds=s(79077),rs=s(59057),_s=s(15126),Es=s(63299),cs=s(67014),gs=s(59080),Ds=s(14718),Ms=s(61535),Os=s(5790),ms=s(41286),us=s(5409),Ps=s(2600),hs=s(51187);const ss={fieldsToPick:[],formErrors:{},initialData:{},isLoading:!0,modifiedData:{},showHeaderButtonLoader:!1,showHeaderLoader:!0},es=(e,t)=>(0,Z.Ay)(e,o=>{switch(t.type){case"GET_DATA_SUCCEEDED":{o.isLoading=!1,o.showHeaderLoader=!1,o.initialData=B(t.data,e.fieldsToPick),o.modifiedData=B(t.data,e.fieldsToPick);break}case"ON_CANCEL":{o.modifiedData=e.initialData,o.formErrors={};break}case"ON_CHANGE":{t.keys.includes("username")&&!t.value?J(o.modifiedData,t.keys.split("."),null):J(o.modifiedData,t.keys.split("."),t.value);break}case"ON_SUBMIT":{o.showHeaderButtonLoader=!0;break}case"ON_SUBMIT_SUCCEEDED":{o.initialData=B(t.data,e.fieldsToPick),o.modifiedData=B(t.data,e.fieldsToPick),o.showHeaderButtonLoader=!1;break}case"SET_ERRORS":{o.formErrors=t.errors,o.showHeaderButtonLoader=!1;break}default:return o}}),as=async(e,t)=>{let o=null;try{await t.validate(e,{abortEarly:!1})}catch(g){g instanceof f.yI&&(o=(0,n.ed)(g))}return o},ts=(e,t,o)=>{const[{formErrors:g,initialData:k,isLoading:D,modifiedData:C,showHeaderButtonLoader:b,showHeaderLoader:R},i]=Y.useReducer(es,{...ss,fieldsToPick:o}),d=(0,n.hN)(),{lockApp:F,unlockApp:U}=(0,n.MA)(),{get:G,put:Q}=(0,n.ry)();return Y.useEffect(()=>{(async()=>{try{const{data:{data:r}}=await G("/admin/providers/options");i({type:"GET_DATA_SUCCEEDED",data:r,fieldsToPick:o})}catch{d({type:"warning",message:{id:"notification.error"}})}})()},[]),[{formErrors:g,initialData:k,isLoading:D,modifiedData:C,showHeaderButtonLoader:b,showHeaderLoader:R},i,{handleCancel:()=>{i({type:"ON_CANCEL"})},handleChange:({target:{name:L,value:r}})=>{i({type:"ON_CHANGE",keys:L,value:r})},handleSubmit:async L=>{L.preventDefault();const r=await as(C,e);if(i({type:"SET_ERRORS",errors:r||{}}),!r)try{F(),i({type:"ON_SUBMIT"});const _=w(C,["confirmPassword","registrationToken"]);_.roles&&(_.roles=_.roles.map(z=>z.id)),_.ssoLockedRoles&&(_.ssoLockedRoles=[...new Set(_.ssoLockedRoles)]);const{data:{data:M}}=await Q("/admin/providers/options",_);t(M),i({type:"ON_SUBMIT_SUCCEEDED",data:M}),d({type:"success",message:{id:"notification.success.saved"}})}catch(_){const M=_?.response?.payload??{data:{}};M?.data&&typeof M.data=="string"?d({type:"warning",message:M.data}):d({type:"warning",message:M.message});const z=(0,q.f)(M);i({type:"SET_ERRORS",errors:z})}finally{U()}},setField:(L,r)=>{i({type:"ON_CHANGE",keys:L,value:r})}}]},os=f.Ik().shape({autoRegister:f.lc().required(n.iW.required),defaultRole:f.gl().when("autoRegister",(e,t)=>e?t.required(n.iW.required):t.nullable()),ssoLockedRoles:f.YO().nullable().of(f.gl().when("ssoLockedRoles",(e,t)=>e?t.required(n.iW.required):t.nullable()))}),X=()=>{(0,n.L4)();const{formatMessage:e}=(0,V.A)(),t=(0,c.d4)(y.s),{isLoading:o,allowedActions:{canUpdate:g,canReadRoles:k}}=(0,n.ec)({...t.settings.sso,readRoles:t.settings.roles.read}),[{formErrors:D,initialData:C,isLoading:b,modifiedData:R,showHeaderButtonLoader:i},,{handleChange:d,handleSubmit:F}]=ts(os,()=>{},["autoRegister","defaultRole","ssoLockedRoles"]),{roles:U,isLoading:G}=(0,H.u)(void 0,{enabled:k}),Q=o||G||b;return(0,a.jsxs)(h.P,{children:[(0,a.jsx)(n.x7,{name:"SSO"}),(0,a.jsx)(A.g,{tabIndex:-1,children:(0,a.jsxs)("form",{onSubmit:F,children:[(0,a.jsx)(K.Q,{primaryAction:(0,a.jsx)(O.$,{"data-testid":"save-button",disabled:N(C,R),loading:i,startIcon:(0,a.jsx)(j.A,{}),type:"submit",size:"L",children:e({id:"global.save",defaultMessage:"Save"})}),title:e({id:"Settings.sso.title",defaultMessage:"Single Sign-On"}),subtitle:e({id:"Settings.sso.description",defaultMessage:"Configure the settings for the Single Sign-On feature."})}),(0,a.jsx)(W.s,{children:Q?(0,a.jsx)(n.Bl,{}):(0,a.jsxs)(v.s,{direction:"column",alignItems:"stretch",gap:4,background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:[(0,a.jsx)(x.o,{variant:"delta",as:"h2",children:e({id:"global.settings",defaultMessage:"Settings"})}),(0,a.jsxs)(m.x,{gap:4,children:[(0,a.jsx)(E.E,{col:6,m:6,s:12,children:(0,a.jsx)(u.l,{"aria-label":"autoRegister","data-testid":"autoRegister",disabled:!g,checked:R.autoRegister,hint:e({id:"Settings.sso.form.registration.description",defaultMessage:"Create new user on SSO login if no account exists"}),label:e({id:"Settings.sso.form.registration.label",defaultMessage:"Auto-registration"}),name:"autoRegister",offLabel:e({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:e({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:l=>{d({target:{name:"autoRegister",value:l.target.checked}})}})}),(0,a.jsx)(E.E,{col:6,m:6,s:12,children:(0,a.jsx)(S.l,{disabled:!g,hint:e({id:"Settings.sso.form.defaultRole.description",defaultMessage:"It will attach the new authenticated user to the selected role"}),error:D.defaultRole?e({id:D.defaultRole.id,defaultMessage:D.defaultRole.id}):"",label:e({id:"Settings.sso.form.defaultRole.label",defaultMessage:"Default role"}),name:"defaultRole",onChange:l=>{d({target:{name:"defaultRole",value:l}})},placeholder:e({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),value:R.defaultRole,children:U.map(({id:l,name:p})=>(0,a.jsx)(I.c,{value:l.toString(),children:p},l))})}),(0,a.jsx)(E.E,{col:6,m:6,s:12,children:(0,a.jsx)(T.KF,{disabled:!g,hint:e({id:"Settings.sso.form.localAuthenticationLock.description",defaultMessage:"Select the roles for which you want to disable the local authentication"}),error:D.ssoLockedRoles?e({id:D.ssoLockedRoles.id,defaultMessage:D.ssoLockedRoles.id}):"",label:e({id:"Settings.sso.form.localAuthenticationLock.label",defaultMessage:"Local authentication lock-out"}),name:"ssoLockedRoles",onChange:l=>{d({target:{name:"ssoLockedRoles",value:l}})},placeholder:e({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),onClear:()=>{d({target:{name:"ssoLockedRoles"}})},value:R.ssoLockedRoles||[],withTags:!0,children:U.map(({id:l,name:p})=>(0,a.jsx)(T.fe,{value:l.toString(),children:p},l))})})]})]})})]})})]})},ns=()=>{const e=(0,c.d4)(y.s);return(0,a.jsx)(n.kz,{permissions:e.settings.sso.main,children:(0,a.jsx)(X,{})})}},89565:($,P,s)=>{s.d(P,{f:()=>a});const a=({data:O})=>{try{return Object.keys(O).reduce((m,E)=>{const h=O[E][0];return m[E]={id:h,defaultMessage:h},m},{})}catch{return{}}}}}]);
